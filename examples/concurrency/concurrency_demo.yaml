# Concurrency Control Example Configuration
# 
# This example demonstrates entry-level concurrency control:
# 1. Configurable base port in monitor section  
# 2. Different concurrency limits for different entries
# 3. How concurrency prevents overwhelming the system
#
# NOTE: concurrency controls how many instances of the SAME entry can run simultaneously
# - concurrency: 1 = only one instance at a time (default)
# - concurrency: 2 = up to 2 instances of the same entry can run at once
#
# Usage: cargo run -- --rules examples/concurrency/concurrency_demo.yaml

# Monitor configuration with custom base port
monitor:
  base_port: 8080  # Custom base port instead of default 9990

entries:
  # Simple demonstration: one entry with concurrency: 2
  # This task takes 8 seconds to complete but triggers every 3 seconds
  # With concurrency: 2, maximum 2 instances can run simultaneously
  # The 3rd trigger will wait until one of the running instances completes
  - name: "demo_task"
    trigger: "periodic"
    interval: "3s"    # Triggers every 3 seconds
    action: "send_keys"
    keys: ["bash examples/concurrency/heavy_task.sh", "\r"]  # Takes 5-10 seconds
    concurrency: 2    # Maximum 2 instances can run at the same time

rules:
  # React to task completion messages
  - pattern: "Task completed: (\\w+)"
    action: "send_keys"
    keys: ["echo 'âœ… Acknowledged completion of ${1}'", "\r"]